<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover">
<title>Ø£Ø¯Ø§Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù„ÙƒØªØ§Ø¨Ø© Ù…Ù‚Ø§Ù„Ø§Øª Ø¥Ø­ØªØ±Ø§ÙÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ SEO</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f7f8fb; --bg-2:#f1f5fb; --card:#ffffff; --text:#0c1424; --muted:#5b6472; --accent:#2563eb;
    --ok:#15803d; --warn:#d97706; --error:#dc2626; --border:#e6e9f2; --shadow:0 6px 16px rgba(0,0,0,.08);
    --radius:16px; --radius-sm:12px;
    --sidebar-w:280px;
    --fs-base:13px; --fs-sm:11.5px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:"Cairo",system-ui,Arial,Helvetica,sans-serif; line-height:1.65;
    background:linear-gradient(180deg,var(--bg),var(--bg-2)); color:var(--text);
    -webkit-font-smoothing:antialiased; overflow-x:hidden; font-size:var(--fs-base);
  }
  .wrap{max-width:1200px;margin:0 auto;padding:24px 16px 64px}

  .topbar{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
  .btn{
    border:1px solid var(--border); background:linear-gradient(180deg,#fff,#f9fbff);
    color:var(--text); padding:8px 12px; border-radius:14px; cursor:pointer; font-weight:700; box-shadow:var(--shadow);
    transition:transform .18s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease;
    font-size:12px; text-decoration:none; display:inline-flex; align-items:center; gap:6px;
  }
  .btn:hover{transform:translateY(-2px); border-color:#cbd5e1}
  .btn.home{background:#000; color:#fff; border-color:#000}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .btn.contactTop{ background: var(--accent); border-color: var(--accent); color:#fff; justify-content:center; }
  .btn.contactTop:hover{ background: var(--accent); border-color: var(--accent); color:#fff; }

  .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow)}
  .titleRow{display:flex;align-items:center;gap:10px;justify-content:space-between}
  h1{margin:0;font-size:clamp(18px,2.2vw,24px);font-weight:800;letter-spacing:.2px}
  .sub{margin-top:6px;color:var(--muted);font-size:var(--fs-sm)}
  .logo{width:100%; max-width:180px; align-self:center; object-fit:contain; object-position:center; background:#fff; border-radius:12px; border:1px solid var(--border); padding:8px}
  .title-logo{width:180px; max-width:180px; align-self:center}

  .layout{ display:grid; grid-template-columns: var(--sidebar-w) 1fr; gap:14px; align-items:stretch; }
  #sidePanel{display:flex; height:100%; min-height:0; overflow:hidden;}
  @media (min-width:981px){ #sidePanel{ contain:size; } }
  .sidebar-card{ flex:1 1 auto; height:100%; display:flex; flex-direction:column; gap:10px; min-height:0; overflow:auto; }
  .avatar{width:112px;height:112px;border-radius:50%;background:#fff;padding:6px;object-fit:contain;object-position:center;border:1px solid var(--border);align-self:center}
  .s-list{display:grid; gap:8px}
  .s-item a, .s-text{
    display:block; padding:8px 10px; border:1px solid var(--border); border-radius:12px; background:#fff;
    color:#0f172a; text-decoration:none; font-weight:600; transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    box-shadow:0 4px 12px rgba(15,23,42,.05); font-size:13px;
  }
  .s-item a:hover{transform:translateY(-2px); border-color:#cbd5e1; box-shadow:0 8px 18px rgba(15,23,42,.08)}

  #toolBox{display:block; min-height:0}
  .row{
    display:grid; gap:16px; align-items:stretch;
    grid-template-columns: minmax(0,1fr) minmax(0,1fr);
    grid-template-areas:"inputs outputs";
    min-width:0;
  }
  @media (max-width:1024px){
    .row{ grid-template-columns:1fr; grid-template-areas:"inputs" "outputs"; gap:12px; }
  }

  .card.section{padding:16px}
  .field{margin-bottom:14px}
  .field:last-child{ margin-bottom: 0 }
  .label{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px;font-weight:700;font-size:14px}

  input[type="text"], select, textarea{
    width:100%;padding:14px;border:1px solid var(--border);border-radius:14px;background:#fff;color:var(--text)
  }
  .hint{font-size:12px;color:var(--muted)}

  .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
  button{padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;color:var(--text);cursor:pointer}
  button.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  button.loading{opacity:.7;pointer-events:none}
  button.danger{background:#fff;border-color:#fecaca;color:#b91c1c}
  button.download{background:#fff;border-color:var(--ok);color:var(--ok)}
  button.download:hover{background:#f0fdf4}
  
  /* Progress Bar Styles */
  .progress-wrap {
    margin-top: 15px;
    background: #e2e8f0;
    border-radius: 99px;
    height: 8px;
    overflow: hidden;
    display: none; /* hidden by default */
  }
  .progress-bar {
    height: 100%;
    background: var(--accent);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 99px;
  }
  .progress-text {
    font-size: 11px;
    color: var(--muted);
    text-align: center;
    margin-top: 4px;
    font-weight: 700;
  }

  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  .tab{
    padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;
    font-weight:800;font-size:12px;cursor:pointer;
  }
  .tab.active{border-color:#cbd5e1; box-shadow:0 6px 16px rgba(15,23,42,.08)}
  pre.out{
    margin:0; padding:14px; border:1px solid var(--border); border-radius:14px;
    background:#fff; white-space:pre-wrap; word-break:break-word; min-height:260px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    font-size:12px;
  }

  .status{font-size:12px;margin-top:8px;display:flex;align-items:center;gap:8px}
  .status.ok{color:var(--ok)} .status.warn{color:var(--warn)} .status.bad{color:var(--error)}
  .status.hidden{display:none}
  .err{margin-top:8px;font-size:12px;color:var(--error)}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:12px;color:var(--muted)}

  @media (max-width:980px){
    .layout{grid-template-columns:1fr}
    #sidePanel{height:auto; overflow:visible;}
    .avatar{width:104px;height:104px}
  }
  #modeInfo{display:none !important;}
</style>
</head>

<body>
  <div class="wrap" id="app">
    <div class="topbar">
      <button class="btn" id="backBtn">Ø±Ø¬ÙˆØ¹</button>
      <a class="btn home" id="homeBtn" href="https://anasrashed.com" rel="noopener">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a class="btn contactTop" id="contactTopBtn" href="https://contact.anasrashed.com" target="_blank" rel="noopener">ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ</a>
    </div>

    <div class="card">
      <div class="titleRow">
        <div>
          <h1>Ø£Ø¯Ø§Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Pro SEO)</h1>
          <div class="sub">Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø©ØŒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©ØŒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ù‚Ø§Ù„ Ø´Ø§Ù…Ù„ Ø¨Ù‡ÙŠÙƒÙ„ÙŠØ© (H2-H4) Ù…Ø¹ ÙˆØµÙ Ù„Ù„ØµÙˆØ± ÙˆØ¬Ø¯Ø§ÙˆÙ„ Ù…Ù‚Ø§Ø±Ù†Ø©.</div>
        </div>
        <img class="logo title-logo" src="https://i.imgur.com/meUEoP7.png" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" onerror="this.onerror=null; this.src='https://i.imgur.com/meUEoP7.jpg';">
      </div>
    </div>

    <div class="layout" style="margin-top:12px">
      <aside id="sidePanel">
        <div class="card sidebar-card">
          <img class="avatar" src="https://i.imgur.com/B3UkEQ0.jpg" alt="ØµÙˆØ±ØªÙŠ" referrerpolicy="no-referrer" onerror="this.onerror=null; this.src='https://i.imgur.com/B3UkEQ0.png';">
          <div class="s-list">
            <div class="s-item"><a href="https://whoami.anasrashed.com" target="_blank" rel="noopener">Ù…Ù† Ø£Ù†Ø§ØŸ</a></div>
            <div class="s-item"><a href="https://anasrashed.gumroad.com/l/seo-book-for-ecommerce" target="_blank" rel="noopener">ÙƒØªØ§Ø¨ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø³ÙŠÙˆ Ø§Ù„Ø´Ø§Ù…Ù„</a></div>
            <div class="s-item"><a href="https://blog.anasrashed.com" target="_blank" rel="noopener">Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</a></div>
            <div class="sub" style="text-align:center; font-size:18px; margin-top:10px;"><b>Ø®Ø¯Ù…Ø§ØªÙŠ</b></div>
            <div class="s-item"><span class="s-text">ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ø®Ù„ÙŠ</span></div>
            <div class="s-item"><span class="s-text">ØªØ­Ø³ÙŠÙ† Ø®Ø§Ø±Ø¬ÙŠ</span></div>
            <div class="s-item"><span class="s-text">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†</span></div>
            <div class="sub" style="text-align:center; font-size:18px; margin-top:10px;"><b>Ø£Ø¯ÙˆØ§Øª Ø³ÙŠÙˆ Ø§Ø­ØªØ±Ø§ÙÙŠØ©</b></div>
            <div class="s-item"><a href="https://serp.anasrashed.com" target="_blank" rel="noopener">Ø£Ø¯Ø§Ø© SERP AI</a></div>
            <div class="s-item"><a href="https://writer.anasrashed.com" target="_blank" rel="noopener">Ø£Ø¯Ø§Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</a></div>
            <div class="s-item"><a href="https://smg.anasrashed.com" target="_blank" rel="noopener">Ù…Ù†Ø´Ø¦ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></div>
            <div class="s-item"><a href="https://keywords.anasrashed.com" target="_blank" rel="noopener">Ø£Ø¯Ø§Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©</a></div>
            <div class="s-item"><a href="https://checker.anasrashed.com" target="_blank" rel="noopener">ÙØ­Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></div>
          </div>
        </div>
      </aside>

      <section id="toolBox">
        <div class="row">
          <section class="card section" style="grid-area:inputs">
            
            <div class="field">
              <div class="label"><label for="lang">Ø§Ù„Ù„ØºØ©</label></div>
              <select id="lang">
                <option value="ar" selected>Ø¹Ø±Ø¨ÙŠ</option>
                <option value="en">English</option>
                <option value="fr">FranÃ§ais</option>
              </select>
            </div>

            <div class="field">
              <div class="label"><label for="type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚Ø§Ù„</label></div>
              <select id="type">
                <option value="definition">ØªØ¹Ø±ÙŠÙÙŠ (Ø´Ø±Ø­ Ù…ÙÙ‡ÙˆÙ…)</option>
                <option value="guide" selected>Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ (Ø®Ø·ÙˆØ§Øª)</option>
                <option value="comparison">Ù…Ù‚Ø§Ø±Ù†Ø© (Ø¨ÙŠÙ† Ù…Ù†ØªØ¬ÙŠÙ†/Ø®Ø¯Ù…Ø§Øª)</option>
                <option value="list">Ù‚Ø§Ø¦Ù…Ø© (Listicle)</option>
                <option value="problem">Ø­Ù„ Ù…Ø´ÙƒÙ„Ø©</option>
              </select>
            </div>

            <div class="field">
              <div class="label"><label for="tone">Ù†Ø¨Ø±Ø© Ø§Ù„ØµÙˆØª / Ø§Ù„Ø£Ø³Ù„ÙˆØ¨</label></div>
              <select id="tone">
                <option value="professional" selected>Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆØ®Ø¨ÙŠØ±</option>
                <option value="friendly">ÙˆØ¯ÙˆØ¯ ÙˆØ¨Ø³ÙŠØ·</option>
                <option value="persuasive">ØªØ³ÙˆÙŠÙ‚ÙŠ ÙˆØ¥Ù‚Ù†Ø§Ø¹ÙŠ</option>
                <option value="academic">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙˆØ¹Ù„Ù…ÙŠ</option>
                <option value="witty">Ø°ÙƒÙŠ ÙˆÙ…Ø±Ø­</option>
              </select>
            </div>

            <div class="field">
              <div class="label"><label for="idea">Ø§Ù„ÙÙƒØ±Ø© / Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label></div>
              <input id="idea" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£ÙØ¶Ù„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰">
            </div>

            <!-- Ø­Ù‚Ù„ LSI Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
            <div class="field">
              <div class="label"><label for="lsi">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„ÙØ±Ø¹ÙŠØ© (LSI) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label></div>
              <input id="lsi" type="text" placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ø³ÙŠÙ† Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¨Ø­Ø«ØŒ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø²ÙŠØ§Ø±Ø§ØªØŒ Ø¨Ø§Ùƒ Ù„ÙŠÙ†Ùƒ (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)">
              <div class="hint">Ø³ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØªØ¶Ù…ÙŠÙ† Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ù‚.</div>
            </div>

            <div class="field">
              <div class="label"><label for="length">Ø·ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„</label></div>
              <select id="length">
                <option value="short">Ù‚ØµÙŠØ± (â‰ˆ 700 ÙƒÙ„Ù…Ø©)</option>
                <option value="medium" selected>Ù…ØªÙˆØ³Ø· (â‰ˆ 1500 ÙƒÙ„Ù…Ø©)</option>
                <option value="long">Ø·ÙˆÙŠÙ„ ÙˆÙ…ÙØµÙ„ (â‰ˆ 2500 ÙƒÙ„Ù…Ø©)</option>
              </select>
              <div class="chips">
                <span class="chip" id="targetInfo">Ø§Ù„Ù‡Ø¯Ù: 1500 ÙƒÙ„Ù…Ø©</span>
                <span class="chip" id="timeoutInfo">Ø§Ù„Ù…Ù‡Ù„Ø©: â€”</span>
              </div>
            </div>

            <div class="btns">
              <button class="primary" id="generateBtn">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„</button>
              <button id="clearBtn">Ù…Ø³Ø­</button>
              <button class="primary" id="copyBtn">Ù†Ø³Ø®</button>
              
              <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
              <button class="download" id="downloadTxtBtn" disabled>ØªØ­Ù…ÙŠÙ„ TXT</button>
              <button class="download" id="downloadHtmlBtn" disabled>ØªØ­Ù…ÙŠÙ„ HTML</button>
              
              <button class="danger" id="cancelBtn" disabled>Ø¥Ù„ØºØ§Ø¡</button>
            </div>

            <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø°ÙƒÙŠ -->
            <div id="progressContainer" style="display:none">
              <div class="progress-wrap">
                <div class="progress-bar" id="progressBar"></div>
              </div>
              <div class="progress-text" id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø¯Ø¡...</div>
            </div>

            <div id="status" class="status hidden"></div>
            <div id="err" class="err" hidden></div>
          </section>

          <section class="card section" style="grid-area:outputs">
            <div class="tabs">
              <button class="tab active" data-tab="outline">Ø§Ù„Ù‡ÙŠÙƒÙ„ (Outline)</button>
              <button class="tab" data-tab="article">Ø§Ù„Ù…Ù‚Ø§Ù„Ø©</button>
              <button class="tab" data-tab="faq">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</button>
            </div>

            <pre class="out" id="outBox">Ø¬Ø§Ù‡Ø²â€¦ Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø© ÙˆØ§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„".</pre>
            <div class="hint" style="margin-top:10px">
              Ø§Ù„Ù…Ù‚Ø§Ù„ ÙŠØ´Ù…Ù„: ØªØ±ÙˆÙŠØ³Ø§Øª (H2-H4) + Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ù‚Ø§Ø±Ù†Ø© (Ø¥Ø°Ø§ Ù„Ø²Ù…) + ÙˆØµÙ Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©.
            </div>
          </section>
        </div>
      </section>
    </div>
  </div>
<script>
/* ========= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API ========= */
const API_BASE = "https://article-generate.anasshopify88.workers.dev";
const ENDPOINTS = {
  gen: API_BASE + "/api/generate",
  ping: API_BASE + "/ping"
};

const $ = s => document.querySelector(s);
const statusEl = $('#status');
const errEl = $('#err');
const outBox = $('#outBox');

const langEl = $('#lang');
const typeEl = $('#type');
const toneEl = $('#tone');
const ideaEl = $('#idea');
const lsiEl = $('#lsi');
const lengthEl = $('#length');
const targetInfo = $('#targetInfo');
const timeoutInfo = $('#timeoutInfo');

const progressBar = $('#progressBar');
const progressText = $('#progressText');
const progressContainer = $('#progressContainer');

const generateBtn = $('#generateBtn');
const clearBtn = $('#clearBtn');
const copyBtn = $('#copyBtn');
const downloadTxtBtn = $('#downloadTxtBtn');
const downloadHtmlBtn = $('#downloadHtmlBtn');
const cancelBtn = $('#cancelBtn');

/* === Ø²Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù†Ø³Ø® ÙƒÙˆØ¯ HTML (ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ HTML Ø£ÙŠØ¶Ø§Ù‹ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø±) === */
// Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ØªØ±Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ HTML ÙŠØ¯ÙˆÙŠØ§Ù‹ØŒ Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
// Ù„ÙƒÙ† Ù„Ù„Ø£ÙØ¶Ù„ÙŠØ©ØŒ Ø³Ø£ÙØªØ±Ø¶ Ø£Ù†Ùƒ Ø³ØªØ¶ÙŠÙ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± ÙÙŠ Ø§Ù„Ù€ HTML:
// <button class="primary" id="copyHtmlCodeBtn" disabled>Ù†Ø³Ø® ÙƒÙˆØ¯ HTML</button>
// Ø³Ø£Ù‚ÙˆÙ… Ù‡Ù†Ø§ Ø¨Ø¥Ø¶Ø§ÙØªÙ‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ ÙÙŠ Ø­Ø§Ù„ Ù†Ø³ÙŠØª Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø§Ù„Ù€ HTML
if(!document.getElementById('copyHtmlCodeBtn')) {
    const btnHtml = `<button class="download" id="copyHtmlCodeBtn" disabled style="border-color:#2563eb; color:#2563eb;">Ù†Ø³Ø® ÙƒÙˆØ¯ HTML Ù„Ù„Ù…Ø¯ÙˆÙ†Ø©</button>`;
    downloadHtmlBtn.insertAdjacentHTML('beforebegin', btnHtml);
}
const copyHtmlCodeBtn = $('#copyHtmlCodeBtn');


const LENGTH_MAP = { short: 700, medium: 1500, long: 2500 };

function timeoutForLength(len){
  if(len === 'long') return 300000; 
  if(len === 'short') return 120000; 
  return 180000; 
}

function setStatus(kind, msg){
  statusEl.className = 'status ' + (kind||'') + (msg ? '' : ' hidden');
  statusEl.textContent = msg || '';
}
function showErr(msg){
  errEl.hidden = false;
  errEl.textContent = msg;
}
function clearErr(){
  errEl.hidden = true;
  errEl.textContent = '';
}
function getTargetWords(){
  return LENGTH_MAP[lengthEl.value] || 1500;
}
function msToNice(ms){
  const s = Math.max(0, Math.round(ms/1000));
  const m = Math.floor(s/60);
  const r = s % 60;
  return m ? `${m}:${String(r).padStart(2,'0')} Ø¯Ù‚ÙŠÙ‚Ø©` : `${s} Ø«Ø§Ù†ÙŠØ©`;
}

/* ===== Ø¥Ø¯Ø§Ø±Ø© Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø°ÙƒÙŠ ===== */
let progressInterval = null;
function startSmartProgress(duration) {
  progressContainer.style.display = 'block';
  let p = 0;
  progressBar.style.width = '0%';
  progressText.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†...';
  
  const step = 100 / (duration / 1000); 

  progressInterval = setInterval(() => {
    if (p >= 95) {
      // wait
    } else {
      p += (Math.random() * 0.5); 
    }
    
    progressBar.style.width = Math.min(p, 98) + '%';

    if(p > 10 && p < 30) progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (H2, H3)...';
    else if(p >= 30 && p < 60) progressText.textContent = 'Ø¬Ø§Ø±ÙŠ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙÙ‚Ø±Ø§Øª...';
    else if(p >= 60 && p < 80) progressText.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ÙˆÙˆØµÙ Ø§Ù„ØµÙˆØ±...';
    else if(p >= 80) progressText.textContent = 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ù€ SEO...';

  }, 100);
}
function endSmartProgress() {
  if(progressInterval) clearInterval(progressInterval);
  progressBar.style.width = '100%';
  progressText.textContent = 'ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡!';
  setTimeout(() => {
    progressContainer.style.display = 'none';
  }, 2000);
}

/* ===== Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ù…Ù‡Ù„Ø© ===== */
let countdownTimer = null;
let countdownEndsAt = 0;
function stopCountdown(){
  if(countdownTimer) clearInterval(countdownTimer);
  countdownTimer = null;
}
function startCountdown(totalMs){
  stopCountdown();
  countdownEndsAt = Date.now() + totalMs;
  const render = () => {
    const remaining = countdownEndsAt - Date.now();
    timeoutInfo.textContent = remaining <= 0
      ? `Ø§Ù„Ù…Ù‡Ù„Ø© (0:00)`
      : `Ø§Ù„Ù…Ù‡Ù„Ø©: ${msToNice(remaining)}`;
  };
  render();
  countdownTimer = setInterval(render, 1000);
}

/* ===== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ===== */
function fmtOutput(data){
  const outline = (data.outline || '').trim();
  const article  = (data.article || '').trim();
  const faq = Array.isArray(data.faq) ? data.faq : [];

  const faqText = faq.map((x,i)=> `Ø³${i+1}: ${x.q}\n${x.a}`).join('\n\n');

  return {
    outline: outline || 'â€”',
    article: article || 'â€”',
    faq: faqText || 'â€”',
    all: `=== Ø§Ù„Ù‡ÙŠÙƒÙ„ ===\n${outline}\n\n=== Ø§Ù„Ù…Ù‚Ø§Ù„ ===\n${article}\n\n=== Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ===\n${faqText}`
  };
}

/* ===== ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¥Ù„Ù‰ ÙƒÙˆØ¯ HTML Ù†Ø¸ÙŠÙ (Blog Safe) ===== */
function generateCleanHtml() {
  if(!current.article) return '';

  // Ù†Ø¨Ø¯Ø£ Ø¨Ù€ Div Ù†Ø¸ÙŠÙ Ù„Ø¹Ø¯Ù… ØªÙƒØ³ÙŠØ± ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹
  let html = `<!-- Start of Article -->\n<div class="article-content">\n\n`;
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø¯Ù…Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  if(lsiEl.value) {
      html += `<p class="meta-tags" style="font-size:0.9em;color:#666;"><em>ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª ØµÙ„Ø©: ${lsiEl.value}</em></p>\n<hr />\n\n`;
  }

  let lines = current.article.split('\n');
  let inTable = false;
  let listMode = false;

  lines.forEach(line => {
    line = line.trim();
    if(!line) return;

    // Headings
    if(line.startsWith('H2:')) {
      if(listMode) { html += '</ul>\n'; listMode = false; }
      html += `<h2>${line.replace('H2:','').trim()}</h2>\n`;
    } 
    else if(line.startsWith('H3:')) {
      if(listMode) { html += '</ul>\n'; listMode = false; }
      html += `<h3>${line.replace('H3:','').trim()}</h3>\n`;
    } 
    else if(line.startsWith('H4:')) {
      if(listMode) { html += '</ul>\n'; listMode = false; }
      html += `<h4>${line.replace('H4:','').trim()}</h4>\n`;
    } 
    // Image Prompts (Ù†Ø¬Ø¹Ù„Ù‡Ø§ ÙƒØªØ¹Ù„ÙŠÙ‚ Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù…ÙŠØ²Ø©)
    else if(line.includes('[IMAGE PROMPT:')) {
      if(listMode) { html += '</ul>\n'; listMode = false; }
      const promptText = line.replace(/\[IMAGE PROMPT:|\]/g,'').trim();
      html += `<div style="background:#f3f4f6; padding:15px; border-right:4px solid #2563eb; margin:15px 0; font-size:0.9em;">
        <strong>ğŸ“¸ ØµÙˆØ±Ø© Ù…Ù‚ØªØ±Ø­Ø©:</strong> ${promptText}
      </div>\n`;
    }
    // Tables (Markdown Style to HTML)
    else if(line.startsWith('|')) {
      if(listMode) { html += '</ul>\n'; listMode = false; }
      if(!inTable) { 
          html += '<table border="1" style="width:100%; border-collapse:collapse; margin:20px 0;">\n'; 
          inTable = true; 
      }
      
      let cols = line.split('|').filter(c => c.trim() !== '');
      if(line.includes('---')) {
         // ØªØ®Ø·ÙŠ Ø³Ø·Ø± Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙÙŠ Ø§Ù„Ù…Ø§Ø±Ùƒ Ø¯Ø§ÙˆÙ†
      } else {
         // Ù†ÙØªØ±Ø¶ Ø£Ù† Ø£ÙˆÙ„ ØµÙ Ù‡Ùˆ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„
         // (Ù„Ù„ØªØ¨Ø³ÙŠØ· Ø³Ù†Ø¬Ø¹Ù„ Ø§Ù„ÙƒÙ„ td Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Ù†Ø§ ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯)
         html += '  <tr>\n';
         cols.forEach(c => {
             html += `    <td style="padding:10px; border:1px solid #ddd;">${c.trim()}</td>\n`;
         });
         html += '  </tr>\n';
      }
    } 
    // Lists (Simple detection)
    else if(line.startsWith('- ') || line.startsWith('â€¢ ')) {
        if(!listMode) { html += '<ul>\n'; listMode = true; }
        html += `  <li>${line.replace(/^[-â€¢]\s+/,'').trim()}</li>\n`;
    }
    // Normal Paragraphs
    else {
      if(inTable && !line.startsWith('|')) { html += '</table>\n'; inTable = false; }
      if(listMode) { html += '</ul>\n'; listMode = false; }
      html += `<p>${line}</p>\n`;
    }
  });

  if(inTable) html += '</table>\n';
  if(listMode) html += '</ul>\n';

  // FAQ Section
  if(current.faq) {
    html += `\n<hr />\n<h2>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h2>\n<div class="faq-section">\n`;
    let faqLines = current.faq.split('\n');
    faqLines.forEach(l => {
        if(l.startsWith('Ø³')) html += `  <h3>${l}</h3>\n`;
        else if(l.trim()) html += `  <p>${l}</p>\n`;
    });
    html += `</div>\n`;
  }

  html += `\n</div><!-- End of Article -->`;
  return html;
}

/* ===== Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API ===== */
let currentController = null;
let currentTimeoutId = null;

function setUIBusy(isBusy){
  generateBtn.disabled = isBusy;
  clearBtn.disabled = isBusy;
  copyBtn.disabled = isBusy;
  downloadTxtBtn.disabled = isBusy || !current.all;
  downloadHtmlBtn.disabled = isBusy || !current.all;
  copyHtmlCodeBtn.disabled = isBusy || !current.all;
  cancelBtn.disabled = !isBusy;

  if(isBusy){
    generateBtn.classList.add('loading');
    generateBtn.textContent = '... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„';
  } else {
    generateBtn.classList.remove('loading');
    generateBtn.textContent = 'ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„';
  }
}

async function aiGenerate(payload){
  if(currentController) throw new Error('ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°.');

  const controller = new AbortController();
  currentController = controller;

  const timeoutMs = timeoutForLength(payload.length);
  startCountdown(timeoutMs);
  startSmartProgress(timeoutMs * 0.8); 

  currentTimeoutId = setTimeout(()=> {
    try { controller.abort(); } catch(e){}
  }, timeoutMs);

  try{
    const resp = await fetch(ENDPOINTS.gen, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload),
      mode:'cors',
      signal: controller.signal
    });

    const text = await resp.text();
    if(!resp.ok){
      let msg = text;
      try{ msg = JSON.parse(text).message; }catch(e){}
      throw new Error(msg || `HTTP ${resp.status}`);
    }

    return JSON.parse(text);
  } catch(e){
    if(e?.name === 'AbortError') throw new Error('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨.');
    throw e;
  } finally {
    if(currentTimeoutId) clearTimeout(currentTimeoutId);
    currentTimeoutId = null;
    currentController = null;
    stopCountdown();
    endSmartProgress();
    timeoutInfo.textContent = `Ø§Ù„Ù…Ù‡Ù„Ø©: ${msToNice(timeoutForLength(lengthEl.value))}`;
  }
}

/* ===== Tabs Logic ===== */
let current = { outline:'', article:'', faq:'', all:'' };
let activeTab = 'outline';

function renderTab(){
  outBox.textContent = current[activeTab] || 'â€”';
  const hasData = !!current.all;
  downloadTxtBtn.disabled = !hasData;
  downloadHtmlBtn.disabled = !hasData;
  copyHtmlCodeBtn.disabled = !hasData;
}
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    activeTab = btn.dataset.tab;
    renderTab();
  });
});

$('#backBtn').addEventListener('click', ()=>history.back());

clearBtn.addEventListener('click', ()=>{
  ideaEl.value = '';
  lsiEl.value = '';
  current = { outline:'', article:'', faq:'', all:'' };
  activeTab = 'outline';
  renderTab();
  outBox.textContent = 'Ø¬Ø§Ù‡Ø²â€¦ Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø© ÙˆØ§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„".';
  setStatus('', '');
  clearErr();
  progressBar.style.width='0%';
  progressContainer.style.display='none';
});

copyBtn.addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(current.all || outBox.textContent || '');
    setStatus('ok', 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ.');
  }catch(e){ setStatus('bad', 'ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®.'); }
});

/* ===== ÙˆØ¸ÙŠÙØ© Ø²Ø± Ù†Ø³Ø® ÙƒÙˆØ¯ HTML Ù„Ù„Ù…Ø¯ÙˆÙ†Ø© (Ø§Ù„Ø£Ù‡Ù…) ===== */
copyHtmlCodeBtn.addEventListener('click', async () => {
    const cleanHtml = generateCleanHtml();
    if(!cleanHtml) return;
    try {
        await navigator.clipboard.writeText(cleanHtml);
        setStatus('ok', 'ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ HTML! Ø§Ù„ØµÙ‚Ù‡ Ø§Ù„Ø¢Ù† ÙÙŠ Ù…Ø¯ÙˆÙ†ØªÙƒ (Custom HTML).');
    } catch(e) {
        setStatus('bad', 'ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®.');
    }
});

/* ===== ØªØ­Ù…ÙŠÙ„ TXT ===== */
downloadTxtBtn.addEventListener('click', ()=>{
  if(!current.all) return;
  const blob = new Blob([current.all], { type: "text/plain;charset=utf-8" });
  downloadFile(blob, 'txt');
});

/* ===== ØªØ­Ù…ÙŠÙ„ HTML ÙƒÙ…Ù„Ù (Preview) ===== */
downloadHtmlBtn.addEventListener('click', ()=>{
  if(!current.article) return;
  const cleanContent = generateCleanHtml();
  
  // Ù‡Ù†Ø§ Ù†ØºÙ„Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ø¸ÙŠÙ Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© ÙˆÙŠØ¨ ÙƒØ§Ù…Ù„Ø© ÙÙ‚Ø· Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²
  let fullPage = `
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<title>${ideaEl.value}</title>
<style>
  body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height:1.8; max-width:800px; margin:40px auto; padding:20px; color:#333;} 
  h2{color:#1e40af; border-bottom:2px solid #e2e8f0; padding-bottom:10px; margin-top:40px;} 
  h3{color:#1e3a8a; margin-top:30px;}
  table{width:100%; border-collapse:collapse; margin:20px 0;} 
  td, th{border:1px solid #cbd5e1; padding:12px; text-align:right;} 
  blockquote{background:#f8fafc; border-right:5px solid #2563eb; margin:20px 0; padding:15px; font-style:italic;}
  .article-content { background:#fff; padding:40px; border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,0.05); }
</style>
</head>
<body>
  <div style="text-align:center; margin-bottom:40px;">
    <h1>${ideaEl.value}</h1>
    <p style="color:#64748b;">ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© Ø£Ø¯Ø§Ø© Ø£Ù†Ø³ Ø±Ø§Ø´Ø¯ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
  </div>
  ${cleanContent}
</body></html>`;
  
  const blob = new Blob([fullPage], { type: "text/html;charset=utf-8" });
  downloadFile(blob, 'html');
});

function downloadFile(blob, ext) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  let safeName = (ideaEl.value || 'article').replace(/[^a-z0-9\u0600-\u06FF]/gi, '_').substring(0, 50);
  a.download = `${safeName}.${ext}`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  setStatus('ok', `ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ${ext.toUpperCase()}.`);
}

lengthEl.addEventListener('change', ()=>{
  targetInfo.textContent = `Ø§Ù„Ù‡Ø¯Ù: ${getTargetWords()} ÙƒÙ„Ù…Ø©`;
  timeoutInfo.textContent = `Ø§Ù„Ù…Ù‡Ù„Ø©: ${msToNice(timeoutForLength(lengthEl.value))}`;
});

cancelBtn.addEventListener('click', ()=>{
  if(currentController){
    try { currentController.abort(); } catch(e){}
    setStatus('warn', 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆÙ„ÙŠØ¯.');
  }
});

generateBtn.addEventListener('click', async ()=>{
  clearErr(); setStatus('', '');
  const idea = (ideaEl.value || '').trim();
  if(!idea){ setStatus('warn', 'Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø©/Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£ÙˆÙ„Ø§Ù‹.'); return; }
  setUIBusy(true);
  setStatus('warn', 'Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„â€¦ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹.');

  try{
    const payload = {
      idea,
      lsi: lsiEl.value, 
      lang: langEl.value,
      kind: typeEl.value,
      tone: toneEl.value,
      length: lengthEl.value,
      target_words: getTargetWords()
    };

    const data = await aiGenerate(payload);
    const out = fmtOutput(data);
    current = out;
    renderTab();

    setStatus('ok', 'ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­.');
  }catch(e){
    setStatus('bad', 'ÙØ´Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯.');
    showErr('Ø®Ø·Ø£: ' + String(e?.message || e || ''));
  }finally{
    setUIBusy(false);
  }
});

targetInfo.textContent = `Ø§Ù„Ù‡Ø¯Ù: ${getTargetWords()} ÙƒÙ„Ù…Ø©`;
timeoutInfo.textContent = `Ø§Ù„Ù…Ù‡Ù„Ø©: ${msToNice(timeoutForLength(lengthEl.value))}`;
setUIBusy(false);
</script>
</body>
</html>
